"undefined"!=typeof window&&window;class e{constructor(e,t,n){this.url=e,t&&(this.name=t),n&&(this.parent=n)}}class t extends e{async getContent(){if(!this.content){const e=await async function(e){const t=await fetch(`${o}/get_file`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionID:s,url:e})});return t.ok?t.json():(console.error("Error making propfind request:",t.statusText),[])}(this.url);this.content=e.content||"",this.etag=e.etag||""}return this.content}}class n extends e{async getEntries(){const e=new URL(a).origin;if(!this.entries){const a=await async function(e){const t=await fetch(`${o}/propfind`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionID:s,url:e})});return t.ok?t.json():(console.error("Error making propfind request:",t.statusText),[])}(this.url);a.shift(),this.entries=[];for(const o of a)o.href.endsWith("/")?this.entries.push(new n(e+o.href,o.href.split("/").slice(-2,-1)[0],this)):(o.href.endsWith(".md")||o.href.endsWith(".txt"))&&this.entries.push(new t(e+o.href,o.href.split("/").pop(),this));console.log(this.entries)}return this.entries}async createFolder(e){if(await async function(e){const t=await fetch(`${o}/create_folder`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionID:s,url:e})});return!!t.ok||(console.error("Error making create request:",t.statusText),!1)}(this.url+"/"+e)){const t=new n(this.url+"/"+e,e,this);return this.entries.push(t),t}return null}async createNote(e){if(await async function(e,t){const n=await fetch(`${o}/create_file`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionID:s,url:e,data:t})});return!!n.ok||(console.error("Error making create request:",n.statusText),!1)}(this.url+"/"+e,"hello world")){const n=new t(this.url+"/"+e,e,this);return this.entries.push(n),n}return null}}const o="http://localhost:3000";let s=null,a=null;const r=document.getElementById("login_status");async function i(e=!1){r.textContent="Login started...";const t=document.getElementById("url_input").value.trim(),i=document.getElementById("url_input_notes").value.trim(),d=document.getElementById("username_input").value.trim(),u=document.getElementById("password_input").value.trim();d&&u&&t?(s=await async function(e,t,n){const s=await fetch(`${o}/login?serverUrl=${encodeURIComponent(e)}&username=${encodeURIComponent(t)}&password=${encodeURIComponent(n)}`,{method:"GET"});return s.ok?s.text():(console.error("Error logging in:"+s.statusText),null)}(t,d,u),null===s?r.textContent="Login failed":(a=i,r.textContent="Login successful",document.getElementById("big_login_status").style.display="none",async function(){const e=new n(a,"Notes"),t=document.createElement("div");await c(e,t),l.appendChild(t)}()),e&&(localStorage.setItem("url",t),localStorage.setItem("url_notes",i),localStorage.setItem("username",d),localStorage.setItem("password",u))):r.textContent="Please fill in all fields"}!async function(){const e=localStorage.getItem("url"),t=localStorage.getItem("url_notes"),n=localStorage.getItem("username"),o=localStorage.getItem("password");e&&t&&n&&o&&(document.getElementById("url_input").value=e,document.getElementById("url_input_notes").value=t,document.getElementById("username_input").value=n,document.getElementById("password_input").value=o,i())}();const l=document.getElementById("notes");async function c(e,o){const s=document.createElement("div"),a=document.createElement("h2");a.textContent=e.name;const r=document.createElement("button");r.className="button",r.style.marginLeft="70%",r.textContent="New Note",r.addEventListener("click",(async()=>{const t=await e.createNote("New Note.txt");s.appendChild(u(t,o))}));const i=document.createElement("button");i.className="button",i.textContent="New Folder",i.addEventListener("click",(async()=>{const t=await e.createFolder("New Folder");s.appendChild(d(t,o))})),a.appendChild(r);const l=document.createElement("span");l.textContent=" | ",a.appendChild(l),a.appendChild(i),s.appendChild(a);const c=await e.getEntries();for(const e of c)e instanceof n?s.appendChild(d(e,o)):e instanceof t&&s.appendChild(u(e,o));o.appendChild(s)}function d(e,t){const n=document.createElement("div");return n.className="folder",n.textContent="📁 "+e.name,n.addEventListener("click",(async()=>{t.innerHTML="",await c(e,t)})),n}function u(e,t){const n=document.createElement("div");return n.className="note",n.textContent="🗒 "+e.name,n.addEventListener("click",(async()=>{t.textContent=await e.getContent()})),n}const m=document.getElementById("settings_button"),p=document.getElementById("settings");m.addEventListener("click",(()=>{p.style.display=""===p.style.display||"none"===p.style.display?"block":"none"})),document.addEventListener("click",(e=>{"block"!==p.style.display||p.contains(e.target)||m.contains(e.target)||(p.style.display="none")})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&(p.style.display="none")})),document.getElementById("login_button").addEventListener("click",(()=>{i()})),document.getElementById("login_remember_button").addEventListener("click",(()=>{i(!0)})),document.getElementById("login_forget_button").addEventListener("click",(()=>{localStorage.removeItem("url"),localStorage.removeItem("url_notes"),localStorage.removeItem("username"),localStorage.removeItem("password"),document.getElementById("big_login_status").style.display="block"}));export{a as baseURL,o as proxyURL,s as sessionID};
//# sourceMappingURL=notesBundle.js.map
