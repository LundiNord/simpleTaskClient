"undefined"!=typeof window&&window;class e{constructor(e,n,s,a){n&&s?(this.data=e,this.etag=n,this.url=s,this.summary=t(e).summary,this.uuid=t(e).uid,this.created=t(e).created,this.lastModified=t(e).lastModified,this.dtstamp=t(e).dtstamp,this.localTask=!1,this.completed=t(e).completed,this.due=t(e).due):(this.summary=e,this.localTask=!0),null!=a&&(this.localTask=a)}setDone(){this.localTask||(this.data=null),this.completed=!0}setNotDone(){this.localTask||(this.data=null),this.completed=!1}getUrl(){return this.url||(this.url=this.summary+"_"+Math.random().toString(36).substring(2,7)+".ics"),this.url}setUrl(e){this.url=e}getData(){return this.data?this.data:(this.uuid||(this.uuid=crypto.randomUUID()),this.created||(this.created=n()),this.lastModified||(this.lastModified=n()),this.dtstamp||(this.dtstamp=n()),"BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Simple Task Client 0.1\nBEGIN:VTODO\nUID:"+this.uuid+"\nCREATED:"+this.created+"\nLAST-MODIFIED:"+this.lastModified+"\nDTSTAMP:"+this.dtstamp+"\nSUMMARY:"+this.summary+"\n"+(this.completed?"STATUS:COMPLETED\n":"")+(this.due?"DUE:"+this.due+"\n":"")+"END:VTODO\nEND:VCALENDAR")}updateTaskName(e){this.summary=e,this.localTask||(this.data=null)}getSummary(){return this.summary}getDue(){if(!this.due)return this.due;return`${this.due.substring(0,4)}-${this.due.substring(4,6)}-${this.due.substring(6,8)}T${this.due.substring(9,11)}:${this.due.substring(11,13)}`}setDue(e){const t=new Date(e);this.due=t.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",this.localTask||(this.data=null)}}function t(e){let t=null;const n=e.match(/BEGIN:VTODO[\s\S]*?END:VTODO/g);return n&&n.forEach((e=>{const n=RegExp(/UID:(.*)/).exec(e)[1].trim(),s=RegExp(/CREATED:(.*)/).exec(e)[1].trim(),a=RegExp(/LAST-MODIFIED:(.*)/).exec(e)[1].trim(),o=RegExp(/DTSTAMP:(.*)/).exec(e)[1].trim(),l=RegExp(/SUMMARY:(.*)/).exec(e)[1].trim(),i=RegExp(/STATUS:(.*)/).exec(e),d=i?i[1].trim():null;let c=!1;d&&"COMPLETED"===d&&(c=!0);const r=RegExp(/DUE:(.*)/).exec(e),u=r?r[1].trim():null;t={uid:n,created:s,lastModified:a,dtstamp:o,summary:l,completed:c,due:u}})),t}function n(){return(new Date).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}const s="https://task-backend.nyxnord.de";let a=null;async function o(e){const t=await fetch(`${s}/tasks?sessionID=${encodeURIComponent(a)}&calender=${encodeURIComponent(JSON.stringify(e))}`,{method:"GET"});return t.ok?t.json():(console.error("Error getting tasks:"+t.statusText),null)}async function l(e){if(!e.localTask){const t=await fetch(`${s}/update_task`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionID:a,filename:e.getUrl(),data:e.getData(),etag:e.etag})});return t.ok&&(e.etag=await t.text()),t.ok}}async function i(e,t){const n=await fetch(`${s}/create_task`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionID:a,calendar:e,filename:t.getUrl(),data:t.getData()})});if(n.ok){t.etag=await n.text();const s=await o(e);for(const e of s)e.etag===t.etag&&t.setUrl(e.url)}return n.ok}const d=document.getElementById("login_status");async function c(t=!1){d.textContent="Login started...";const n=document.getElementById("url_input").value.trim(),l=document.getElementById("username_input").value.trim(),c=document.getElementById("password_input").value.trim();l&&c&&n?(a=await async function(e,t,n){const a=await fetch(`${s}/login?serverUrl=${encodeURIComponent(e)}&username=${encodeURIComponent(t)}&password=${encodeURIComponent(n)}`,{method:"GET"});return a.ok?a.text():(console.error("Error logging in:"+a.statusText),null)}(n,l,c),null===a?d.textContent="Login failed":(d.textContent="Login successful",document.getElementById("big_login_status").style.display="none",async function(){if(!a)return;const t=await async function(){const e=await fetch(`${s}/tasklists?sessionID=${encodeURIComponent(a)}`,{method:"GET"});return e.ok?e.json():(console.error("Error getting calendars:"+e.statusText),null)}();for(const n of t){let t=document.createElement("div");const s=document.createElement("h2");s.textContent=n.displayName;const a=document.createElement("button");a.className="button",a.style.marginLeft="70%",a.textContent="New Task",a.addEventListener("click",(async()=>{const s=new e("New Task",null,null,!1);await i(n,s)&&t.insertBefore(g(s,!0),t.lastChild)})),s.appendChild(a),t.appendChild(s);let l=document.createElement("div"),d=document.createElement("div");d.className="collapsible";let c=document.createElement("button");c.className="button",c.textContent="Show Done",c.addEventListener("click",(async()=>{d.style.maxHeight?d.style.maxHeight=null:d.style.maxHeight=d.scrollHeight+"px"})),l.appendChild(c),l.appendChild(d);const u=await o(n);for(const n of u){console.log(n);const s=new e(n.data,n.etag,n.url);s.completed?d.appendChild(g(s)):t.appendChild(g(s))}t.appendChild(l),r.appendChild(t)}}()),t&&(localStorage.setItem("url",n),localStorage.setItem("username",l),localStorage.setItem("password",c))):d.textContent="Please fill in all fields"}!async function(){const e=localStorage.getItem("url"),t=localStorage.getItem("username"),n=localStorage.getItem("password");e&&t&&n&&(document.getElementById("url_input").value=e,document.getElementById("username_input").value=t,document.getElementById("password_input").value=n,c())}();const r=document.getElementById("task_list");const u=document.getElementById("local_task_list");let m=null;async function p(){localStorage.setItem("local_tasks",JSON.stringify(m))}function h(){u.innerHTML="";for(const e of m)u.appendChild(g(e))}function g(e,t=!1){let n=document.createElement("div");n.className="task";let o=document.createElement("input");o.type="checkbox",o.className="task_checkbox",o.checked=e.completed,o.addEventListener("change",(()=>{o.checked?(e.setDone(),k&&function(){const e=document.getElementById("unicorn");e.style.display="block",setTimeout((()=>{e.style.display="none"}),3e3)}()):e.setNotDone(),l(e),p()})),n.appendChild(o);let i=document.createElement("span");i.textContent=" "+e.getSummary(),i.style.width="100%";let d=document.createElement("div");d.className="popup";let c=document.createElement("label"),r=document.createElement("input"),g=document.createElement("label"),y=document.createElement("input"),E=document.createElement("button");const f=document.createElement("span");f.textContent="Edit Name: ",c.appendChild(f),c.appendChild(r),r.value=e.getSummary(),r.addEventListener("change",(()=>{e.updateTaskName(r.value),i.textContent=" "+e.getSummary()})),E.className="button",E.textContent="Delete Task",E.style.color="#c21919",E.addEventListener("click",(()=>{d.style.display="none",document.removeEventListener("keydown",C),document.removeEventListener("click",T),async function(e,t){if(!e.localTask){try{if((await fetch(`${s}/delete_task`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionID:a,filename:e.getUrl(),etag:e.etag})})).ok)return t.parentElement.removeChild(t),!0}catch(e){console.error("Error deleting task:",e)}return!1}m=m.filter((t=>t!==e)),u.removeChild(t),await p()}(e,n)}));const I=document.createElement("span");I.textContent="Edit Due Date: ",g.appendChild(I),g.appendChild(y),y.type="datetime-local",y.value=e.getDue(),y.addEventListener("change",(()=>{e.setDue(y.value)})),d.appendChild(c),d.appendChild(document.createElement("br")),d.appendChild(g),d.appendChild(document.createElement("br")),d.appendChild(document.createElement("br")),d.appendChild(E);const C=t=>{"Escape"===t.key&&(d.style.display="none",document.removeEventListener("keydown",C),document.removeEventListener("click",T),l(e),p(),h())},T=t=>{d.contains(t.target)||t.target===i||(d.style.display="none",document.removeEventListener("keydown",C),document.removeEventListener("click",T),l(e),p(),h())};return i.addEventListener("click",(()=>{d.style.display="block",setTimeout((()=>{document.addEventListener("keydown",C),document.addEventListener("click",T)}),10)})),t&&(d.style.display="block",setTimeout((()=>{document.addEventListener("keydown",C),document.addEventListener("click",T)}),10)),n.appendChild(i),n.appendChild(d),n}document.getElementById("create_local_button").addEventListener("click",(()=>{const t=new e("New Task");m.push(t),p(),u.appendChild(g(t,!0))})),function(){const t=JSON.parse(localStorage.getItem("local_tasks"));null===t||0===t.length?(m=[],m.push(new e("This is your first task!"))):m=t.map((t=>{const n=new e(t.summary);return Object.assign(n,t),n}))}(),h();const y=document.getElementById("settings_button"),E=document.getElementById("settings");y.addEventListener("click",(()=>{E.style.display=""===E.style.display||"none"===E.style.display?"block":"none"})),document.addEventListener("click",(e=>{"block"!==E.style.display||E.contains(e.target)||y.contains(e.target)||(E.style.display="none")})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&(E.style.display="none")})),document.getElementById("login_button").addEventListener("click",(()=>{c()})),document.getElementById("login_remember_button").addEventListener("click",(()=>{c(!0)})),document.getElementById("login_forget_button").addEventListener("click",(()=>{r.innerHTML="",localStorage.removeItem("url"),localStorage.removeItem("username"),localStorage.removeItem("password"),document.getElementById("big_login_status").style.display="block"}));let k=!1;document.getElementById("sparcle_button").addEventListener("click",(()=>{k?(document.body.className="normal",k=!1):(document.body.className="sparcle",k=!0)}));
//# sourceMappingURL=taskBundle.js.map
