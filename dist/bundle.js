"undefined"!=typeof window&&window;class e{constructor(e,n,a,s){n&&a?(this.data=e,this.etag=n,this.url=a,this.summary=t(e).summary,this.uuid=t(e).uid,this.created=t(e).created,this.lastModified=t(e).lastModified,this.dtstamp=t(e).dtstamp,this.localTask=!1,this.completed=t(e).completed):(this.summary=e,this.localTask=!0),null!=s&&(this.localTask=s)}setDone(){this.localTask||(this.data=null),this.completed=!0}setNotDone(){this.localTask||(this.data=null),this.completed=!1}getUrl(){return this.url||(this.url=this.summary+"_"+Math.random().toString(36).substring(2,7)+".ics"),this.url}setUrl(e){this.url=e}getData(){return this.data?this.data:(this.uuid||(this.uuid=crypto.randomUUID()),this.created||(this.created=n()),this.lastModified||(this.lastModified=n()),this.dtstamp||(this.dtstamp=n()),"BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Simple Task Client 0.1\nBEGIN:VTODO\nUID:"+this.uuid+"\nCREATED:"+this.created+"\nLAST-MODIFIED:"+this.lastModified+"\nDTSTAMP:"+this.dtstamp+"\nSUMMARY:"+this.summary+"\n"+(this.completed?"STATUS:COMPLETED\n":"")+"END:VTODO\nEND:VCALENDAR")}updateTaskName(e){this.summary=e,this.localTask||(this.data=null)}getSummary(){return this.summary}}function t(e){let t=null;const n=e.match(/BEGIN:VTODO[\s\S]*?END:VTODO/g);return n&&n.forEach((e=>{const n=RegExp(/UID:(.*)/).exec(e)[1].trim(),a=RegExp(/CREATED:(.*)/).exec(e)[1].trim(),s=RegExp(/LAST-MODIFIED:(.*)/).exec(e)[1].trim(),o=RegExp(/DTSTAMP:(.*)/).exec(e)[1].trim(),l=RegExp(/SUMMARY:(.*)/).exec(e)[1].trim(),i=RegExp(/STATUS:(.*)/).exec(e),c=i?i[1].trim():null;let d=!1;c&&"COMPLETED"===c&&(d=!0),t={uid:n,created:a,lastModified:s,dtstamp:o,summary:l,completed:d}})),t}function n(){return(new Date).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}const a="https://task-backend.nyxnord.de";let s=null;async function o(e){const t=await fetch(`${a}/tasks?sessionID=${encodeURIComponent(s)}&calender=${encodeURIComponent(JSON.stringify(e))}`,{method:"GET"});return t.ok?t.json():(console.error("Error getting tasks:"+t.statusText),null)}async function l(e){if(!e.localTask){const t=await fetch(`${a}/update_task`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionID:s,filename:e.getUrl(),data:e.getData(),etag:e.etag})});return t.ok&&(e.etag=await t.text()),t.ok}}async function i(e,t){const n=await fetch(`${a}/create_task`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionID:s,calendar:e,filename:t.getUrl(),data:t.getData()})});if(n.ok){t.etag=await n.text();const a=await o(e);for(const e of a)e.etag===t.etag&&t.setUrl(e.url)}return n.ok}const c=document.getElementById("login_status");async function d(t=!1){c.textContent="Login started...";const n=document.getElementById("url_input").value.trim(),l=document.getElementById("username_input").value.trim(),d=document.getElementById("password_input").value.trim();l&&d&&n?(s=await async function(e,t,n){const s=await fetch(`${a}/login?serverUrl=${encodeURIComponent(e)}&username=${encodeURIComponent(t)}&password=${encodeURIComponent(n)}`,{method:"GET"});return s.ok?s.text():(console.error("Error logging in:"+s.statusText),null)}(n,l,d),null===s?c.textContent="Login failed":(c.textContent="Login successful",document.getElementById("big_login_status").style.display="none",async function(){if(!s)return;const t=await async function(){const e=await fetch(`${a}/tasklists?sessionID=${encodeURIComponent(s)}`,{method:"GET"});return e.ok?e.json():(console.error("Error getting calendars:"+e.statusText),null)}();for(const n of t){let t=document.createElement("div");const a=document.createElement("h2");a.textContent=n.displayName;const s=document.createElement("button");s.className="button",s.style.marginLeft="70%",s.textContent="New Task",s.addEventListener("click",(async()=>{const a=new e("New Task",null,null,!1);await i(n,a)&&t.appendChild(g(a,!0))})),a.appendChild(s),t.appendChild(a);const l=await o(n);for(const n of l){const a=new e(n.data,n.etag,n.url);t.appendChild(g(a))}r.appendChild(t)}}()),t&&(localStorage.setItem("url",n),localStorage.setItem("username",l),localStorage.setItem("password",d))):c.textContent="Please fill in all fields"}!async function(){const e=localStorage.getItem("url"),t=localStorage.getItem("username"),n=localStorage.getItem("password");e&&t&&n&&(document.getElementById("url_input").value=e,document.getElementById("username_input").value=t,document.getElementById("password_input").value=n,d())}();const r=document.getElementById("task_list");const m=document.getElementById("local_task_list");let u=null;async function p(){localStorage.setItem("local_tasks",JSON.stringify(u))}function h(){m.innerHTML="";for(const e of u)m.appendChild(g(e))}function g(e,t=!1){let n=document.createElement("div");n.className="task";let o=document.createElement("input");o.type="checkbox",o.className="task_checkbox",o.checked=e.completed,o.addEventListener("change",(()=>{o.checked?e.setDone():e.setNotDone(),l(e),p()})),n.appendChild(o);let i=document.createElement("span");i.textContent=" "+e.getSummary(),i.style.width="100%";let c=document.createElement("div");c.className="popup";let d=document.createElement("label"),r=document.createElement("input"),g=document.createElement("button");const y=document.createElement("span");y.textContent="Edit Name: ",d.appendChild(y),d.appendChild(r),r.value=e.getSummary(),r.addEventListener("change",(()=>{e.updateTaskName(r.value),i.textContent=" "+e.getSummary()})),g.className="button",g.textContent="Delete Task",g.style.color="#c21919",g.addEventListener("click",(()=>{c.style.display="none",document.removeEventListener("keydown",E),document.removeEventListener("click",k),async function(e,t){if(!e.localTask){try{if((await fetch(`${a}/delete_task`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionID:s,filename:e.getUrl(),etag:e.etag})})).ok)return t.parentElement.removeChild(t),!0}catch(e){console.error("Error deleting task:",e)}return!1}u=u.filter((t=>t!==e)),m.removeChild(t),await p()}(e,n)})),c.appendChild(d),c.appendChild(document.createElement("br")),c.appendChild(document.createElement("br")),c.appendChild(g);const E=t=>{"Escape"===t.key&&(c.style.display="none",document.removeEventListener("keydown",E),document.removeEventListener("click",k),l(e),p(),h())},k=t=>{c.contains(t.target)||t.target===i||(c.style.display="none",document.removeEventListener("keydown",E),document.removeEventListener("click",k),l(e),p(),h())};return i.addEventListener("click",(()=>{c.style.display="block",setTimeout((()=>{document.addEventListener("keydown",E),document.addEventListener("click",k)}),10)})),t&&(c.style.display="block",setTimeout((()=>{document.addEventListener("keydown",E),document.addEventListener("click",k)}),10)),n.appendChild(i),n.appendChild(c),n}document.getElementById("create_local_button").addEventListener("click",(()=>{const t=new e("New Task");u.push(t),p(),m.appendChild(g(t,!0))})),function(){const t=JSON.parse(localStorage.getItem("local_tasks"));null===t||0===t.length?(u=[],u.push(new e("This is your first task!"))):u=t.map((t=>{const n=new e(t.summary);return Object.assign(n,t),n}))}(),h();const y=document.getElementById("settings_button"),E=document.getElementById("settings");y.addEventListener("click",(()=>{E.style.display=""===E.style.display||"none"===E.style.display?"block":"none"})),document.addEventListener("click",(e=>{"block"!==E.style.display||E.contains(e.target)||y.contains(e.target)||(E.style.display="none")})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&(E.style.display="none")})),document.getElementById("login_button").addEventListener("click",(()=>{d()})),document.getElementById("login_remember_button").addEventListener("click",(()=>{d(!0)}));
//# sourceMappingURL=bundle.js.map
