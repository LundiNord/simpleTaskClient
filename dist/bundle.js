"undefined"!=typeof window&&window;class e{constructor(e,t,n){this.done=!1,t&&n?(this.data=e,this.etag=t,this.url=n,this.summary=function(e){let t=null;const n=/BEGIN:VTODO[\s\S]*?END:VTODO/g,o=e.match(n);o&&o.forEach((e=>{const n=e.match(/UID:(.*)/)[1].trim(),o=e.match(/CREATED:(.*)/)[1].trim(),s=e.match(/LAST-MODIFIED:(.*)/)[1].trim(),a=e.match(/DTSTAMP:(.*)/)[1].trim(),l=e.match(/SUMMARY:(.*)/)[1].trim();t={uid:n,created:o,lastModified:s,dtstamp:a,summary:l}}));return t}(e).summary,this.localTask=!1):(this.summary=e,this.localTask=!0)}setDone(){this.done=!0}setNotDone(){this.done=!1}}const t="http://localhost:3000";let n=null;async function o(e){const o=await fetch(`${t}/tasks?sessionID=${encodeURIComponent(n)}&calender=${encodeURIComponent(JSON.stringify(e))}`,{method:"GET"});return o.ok?o.json():(console.error("Error getting tasks:"+o.statusText),null)}const s=document.getElementById("login_status");async function a(a=!1){s.textContent="Login started...";const c=document.getElementById("url_input").value.trim(),d=document.getElementById("username_input").value.trim(),i=document.getElementById("password_input").value.trim();d&&i&&c?(n=await async function(e,n,o){const s=await fetch(`${t}/login?serverUrl=${encodeURIComponent(e)}&username=${encodeURIComponent(n)}&password=${encodeURIComponent(o)}`,{method:"GET"});return s.ok?s.text():(console.error("Error logging in:"+s.statusText),null)}(c,d,i),null===n?s.textContent="Login failed":(s.textContent="Login successful",document.getElementById("big_login_status").style.display="none",async function(){if(!n)return;const s=await async function(){const e=await fetch(`${t}/tasklists?sessionID=${encodeURIComponent(n)}`,{method:"GET"});return e.ok?e.json():(console.error("Error getting calendars:"+e.statusText),null)}();for(const t of s){let n=document.createElement("div");const s=document.createElement("h2");s.textContent=t.displayName,n.appendChild(s);const a=await o(t);for(const t of a){const o=new e(t.data,t.etag,t.url);n.appendChild(m(o))}l.appendChild(n)}}()),a&&(localStorage.setItem("url",c),localStorage.setItem("username",d),localStorage.setItem("password",i))):s.textContent="Please fill in all fields"}!async function(){const e=localStorage.getItem("url"),t=localStorage.getItem("username"),n=localStorage.getItem("password");e&&t&&n&&(document.getElementById("url_input").value=e,document.getElementById("username_input").value=t,document.getElementById("password_input").value=n,a())}();const l=document.getElementById("task_list");const c=document.getElementById("local_task_list");let d=null;async function i(){localStorage.setItem("local_tasks",JSON.stringify(d))}function r(){c.innerHTML="";for(const e of d)c.appendChild(m(e))}function m(e,t=!1){let n=document.createElement("div");n.className="task";let o=document.createElement("input");o.type="checkbox",o.className="task_checkbox",o.checked=e.done,o.addEventListener("change",(t=>{o.checked?e.setDone():e.setNotDone(),i()})),n.appendChild(o);let s=document.createElement("span");s.textContent=" "+e.summary,s.style.width="100%";let a=document.createElement("div");a.className="popup";let l=document.createElement("label"),m=document.createElement("input"),u=document.createElement("button");const p=document.createElement("span");p.textContent="Edit Name: ",l.appendChild(p),l.appendChild(m),m.value=e.summary,m.addEventListener("change",(t=>{!async function(e,t){e.summary=t,e.localTask}(e,m.value)})),u.className="button",u.textContent="Delete Task",u.style.color="#c21919",u.addEventListener("click",(t=>{a.style.display="none",document.removeEventListener("keydown",y),document.removeEventListener("click",E),d=d.filter((t=>t!==e)),c.removeChild(n),i()})),a.appendChild(l),a.appendChild(document.createElement("br")),a.appendChild(document.createElement("br")),a.appendChild(u);const y=e=>{"Escape"===e.key&&(a.style.display="none",document.removeEventListener("keydown",y),document.removeEventListener("click",E),i(),r())},E=e=>{a.contains(e.target)||e.target===s||(a.style.display="none",document.removeEventListener("keydown",y),document.removeEventListener("click",E),i(),r())};return s.addEventListener("click",(e=>{a.style.display="block",setTimeout((()=>{document.addEventListener("keydown",y),document.addEventListener("click",E)}),10)})),t&&(a.style.display="block",setTimeout((()=>{document.addEventListener("keydown",y),document.addEventListener("click",E)}),10)),n.appendChild(s),n.appendChild(a),n}document.getElementById("create_local_button").addEventListener("click",(t=>{const n=new e("New Task");d.push(n),i(),c.appendChild(m(n,!0))})),function(){const t=JSON.parse(localStorage.getItem("local_tasks"));null===t||0===t.length?(d=[],d.push(new e("This is your first task!"))):d=t.map((t=>{const n=new e(t.summary);return Object.assign(n,t),n}))}(),r();const u=document.getElementById("settings_button"),p=document.getElementById("settings");u.addEventListener("click",(()=>{p.style.display=""===p.style.display||"none"===p.style.display?"block":"none"})),document.addEventListener("click",(e=>{"block"!==p.style.display||p.contains(e.target)||u.contains(e.target)||(p.style.display="none")})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&(p.style.display="none")})),document.getElementById("login_button").addEventListener("click",(()=>{a()})),document.getElementById("login_remember_button").addEventListener("click",(()=>{a(!0)}));
//# sourceMappingURL=bundle.js.map
