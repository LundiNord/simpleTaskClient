{"version":3,"file":"taskBundle.js.map","sources":["../src/task.ts","../src/tasksList.ts"],"sourcesContent":["export class Task {\n    constructor(dataOrSummary: string, etag?: string, url?: string, localTask?: boolean) {\n         if (etag && url) {\n             this.data = dataOrSummary;\n             this.etag = etag;\n             this.url = url;\n             this.summary = getInfoFromICal(dataOrSummary).summary;\n             this.uuid = getInfoFromICal(dataOrSummary).uid;\n             this.created = getInfoFromICal(dataOrSummary).created;\n             this.lastModified = getInfoFromICal(dataOrSummary).lastModified;\n             this.dtstamp = getInfoFromICal(dataOrSummary).dtstamp;\n             this.localTask = false;\n             this.completed = getInfoFromICal(dataOrSummary).completed;\n             this.due = getInfoFromICal(dataOrSummary).due;\n         } else {\n             this.summary = dataOrSummary;\n             this.localTask = true;\n         }\n         if (localTask != null) {\n                this.localTask = localTask;\n         }\n     }\n    private summary: string;\n    private data: string;\n    etag: string;\n    uuid: string;\n    created: string;\n    lastModified: string;\n    dtstamp: string;\n    completed: boolean;\n    private url: string;\n    public readonly localTask: boolean;\n    due: string;    //null or 20250404T150000Z\n    //------------------\n    public setDone():void {\n        if (!this.localTask) {\n            this.data = null;\n        }\n        this.completed = true;\n    }\n    public setNotDone():void {\n        if (!this.localTask) {\n            this.data = null;\n        }\n        this.completed = false;\n    }\n    public getUrl():string {\n        if (this.url) {\n            return this.url;\n        }\n        this.url = this.summary + '_' + Math.random().toString(36).substring(2, 7) + '.ics';\n        return this.url;\n    }\n    public setUrl(url:string):void {\n        this.url = url;\n    }\n    public getData():string {\n        if (this.data) {\n            return this.data;\n        }\n        if(!this.uuid) {\n            this.uuid = crypto.randomUUID();\n        }\n        if (!this.created) {\n            this.created = formatDateForICS();\n        }\n        if (!this.lastModified) {\n            this.lastModified = formatDateForICS();\n        }\n        if (!this.dtstamp) {\n            this.dtstamp = formatDateForICS();\n        }\n        return 'BEGIN:VCALENDAR\\n' + 'VERSION:2.0\\n' +\n            'PRODID:-//Simple Task Client 0.1\\n' +\n            'BEGIN:VTODO\\n' +\n            'UID:' + this.uuid + '\\n' +\n            'CREATED:' + this.created + '\\n' +\n            'LAST-MODIFIED:' + this.lastModified + '\\n' +\n            'DTSTAMP:' + this.dtstamp + '\\n' +\n            'SUMMARY:' + this.summary + '\\n' +\n            (this.completed ? 'STATUS:COMPLETED\\n' : '') +\n            (this.due ? 'DUE:' + this.due + '\\n' : '') +\n            'END:VTODO\\n' +\n            'END:VCALENDAR'\n    }\n    public updateTaskName(name:string):void {\n        this.summary = name;\n        if (!this.localTask) {\n            this.data = null;\n        }\n    }\n    public getSummary():string {\n        return this.summary;\n    }\n    public getDue():string {\n        if (!this.due) {\n            return this.due;\n        }\n        const year:string = this.due.substring(0, 4);\n        const month:string = this.due.substring(4, 6);\n        const day:string = this.due.substring(6, 8);\n        const hour:string = this.due.substring(9, 11);\n        const minute:string = this.due.substring(11, 13);\n        return `${year}-${month}-${day}T${hour}:${minute}`;\n    }\n    public setDue(value:string):void {\n        const date = new Date(value);\n        this.due = date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';\n        if (!this.localTask) {\n            this.data = null;\n        }\n    }\n}\n\n//----------------------------- Helpers -----------------------------------\nfunction getInfoFromICal(ical: string):{summary: string, uid: string, created: string, lastModified: string, dtstamp: string, completed: boolean, due: string} {\n    let data:any = null;\n    const regex = /BEGIN:VTODO[\\s\\S]*?END:VTODO/g;\n    const matches = ical.match(regex);\n    if (matches) {\n        matches.forEach((match:string):void => {\n            const uid:string = RegExp(/UID:(.*)/).exec(match)[1].trim();\n            const created:string = RegExp(/CREATED:(.*)/).exec(match)[1].trim();\n            const lastModified:string = RegExp(/LAST-MODIFIED:(.*)/).exec(match)[1].trim();\n            const dtstamp:string = RegExp(/DTSTAMP:(.*)/).exec(match)[1].trim();\n            const summary:string = RegExp(/SUMMARY:(.*)/).exec(match)[1].trim();\n            const statusMatch = RegExp(/STATUS:(.*)/).exec(match);\n            const status:string = statusMatch ? statusMatch[1].trim() : null;\n            let completed:boolean = false;\n            if (status && status === 'COMPLETED') {\n                completed = true;\n            }\n            const dueMatch = RegExp(/DUE:(.*)/).exec(match);\n            const due:string = dueMatch ? dueMatch[1].trim() : null;\n            data = {uid, created, lastModified, dtstamp, summary, completed, due};\n        });\n    }\n    return data;\n}\nfunction formatDateForICS():string {\n    return new Date().toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';\n}\n","import {Task} from \"./task\";\n\n//const proxyURL:string = \"http://localhost:3000\";\nconst proxyURL:string = \"https://task-backend.nyxnord.de\";\nlet sessionID:string = null;\n\n//----------------------------- Proxy Communication -----------------------------------\n\nasync function login(serverUrl: string, username: string, password: string):Promise<string> {\n  const response:Response = await fetch(`${proxyURL}/login?serverUrl=${encodeURIComponent(serverUrl)}&username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`, {\n    method: \"GET\",\n  });\n  if (!response.ok) {\n      console.error(\"Error logging in:\" + response.statusText);\n      return null;\n  } else {\n    return response.text();\n  }\n}\nasync function getCalenders():Promise<any[]> {\n    const response:Response = await fetch(`${proxyURL}/tasklists?sessionID=${encodeURIComponent(sessionID)}`, {\n    method: \"GET\",\n    });\n    if (!response.ok) {\n        console.error(\"Error getting calendars:\" + response.statusText);\n        return null;\n    } else {\n        return response.json();\n    }\n}\nasync function fetchTasks(calender: JSON) {\n     const response:Response = await fetch(`${proxyURL}/tasks?sessionID=${encodeURIComponent(sessionID)}&calender=${encodeURIComponent(JSON.stringify(calender))}`, {\n        method: \"GET\",\n    });\n    if (!response.ok) {\n        console.error(\"Error getting tasks:\" + response.statusText);\n        return null;\n    } else {\n        return response.json();\n    }\n}\nasync function updateRemoteTask(task:Task) {\n    if (!task.localTask) {\n        const response:Response = await fetch(`${proxyURL}/update_task`, {\n            method: \"PUT\",\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                sessionID: sessionID,\n                filename: task.getUrl(),\n                data: task.getData(),\n                etag: task.etag,\n            })\n        });\n        if (response.ok) {\n            task.etag = await response.text();\n        }\n        return response.ok;\n    }\n}\nasync function deleteTask(task:Task, task_div:HTMLElement) {\n    if (task.localTask) {\n        localTasks = localTasks.filter(t => t !== task);\n        local_task_list.removeChild(task_div);\n        await saveLocalTasks();\n    } else {\n        try {\n            const response:Response = await fetch(`${proxyURL}/delete_task`, {\n                method: \"DELETE\",\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    sessionID: sessionID,\n                    filename: task.getUrl(),\n                    etag: task.etag,\n                })\n            });\n            if (response.ok) {\n                task_div.parentElement.removeChild(task_div);\n                return true;\n            }\n        } catch (err) {\n            console.error(\"Error deleting task:\", err);\n        }\n        return false;\n    }\n}\nasync function createRemoteTask(calendar: any, task: Task) {\n    const response:Response = await fetch(`${proxyURL}/create_task`, {\n        method: \"PUT\",\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            sessionID: sessionID,\n            calendar: calendar,\n            filename: task.getUrl(),\n            data: task.getData(),\n        })\n    });\n    if (response.ok) {\n      task.etag = await response.text();        //ToDo create task on popup close\n      const tasks = await fetchTasks(calendar);\n        for (const object of tasks) {\n            if (object.etag === task.etag) {\n                task.setUrl(object.url);\n            }\n        }\n    }\n    return response.ok;\n}\n\n//----------------------------- Login -----------------------------------\nconst login_status:HTMLElement = document.getElementById('login_status');\n\nasync function loginToServer(remember: boolean = false):Promise<void> {\n    login_status.textContent = \"Login started...\";\n    const url:string = (document.getElementById('url_input') as HTMLInputElement).value.trim();\n    const username:string = (document.getElementById('username_input') as HTMLInputElement).value.trim();\n    const password:string = (document.getElementById('password_input') as HTMLInputElement).value.trim();\n    if (!username || !password || !url) {\n        login_status.textContent = \"Please fill in all fields\";\n        return;\n    }\n    sessionID = await login(url, username, password);\n    if (sessionID === null) {\n        login_status.textContent = \"Login failed\";\n    } else {\n        login_status.textContent = \"Login successful\";\n        document.getElementById('big_login_status').style.display = \"none\";\n        fetchAndDisplay();\n    }\n    if (remember) {\n        localStorage.setItem(\"url\", url);\n        localStorage.setItem(\"username\", username);\n        localStorage.setItem(\"password\", password);\n    }\n}\nasync function autoLogin():Promise<void> {\n    const url:string = localStorage.getItem(\"url\");\n    const username:string = localStorage.getItem(\"username\");\n    const password:string = localStorage.getItem(\"password\");\n    if (url && username && password) {\n        (document.getElementById('url_input') as HTMLInputElement).value = url;\n        (document.getElementById('username_input') as HTMLInputElement).value = username;\n        (document.getElementById('password_input') as HTMLInputElement).value = password;\n        loginToServer();\n    }\n}\nautoLogin()\n\n//----------------------------- Show Remote Tasks -----------------------------------\nconst task_list:HTMLElement = document.getElementById('task_list');\n\nasync function fetchAndDisplay():Promise<void> {\n    if (!sessionID) {return}\n    const calendars: any[] = await getCalenders();\n    for (const calendar of calendars) {\n        let calendar_div:HTMLElement = document.createElement('div');\n        const heading:HTMLHeadingElement = document.createElement('h2');\n        heading.textContent = calendar.displayName;\n        //New Task Button\n        const newTaskButton:HTMLButtonElement = document.createElement('button');\n        newTaskButton.className = 'button';\n        newTaskButton.style.marginLeft = \"70%\";\n        newTaskButton.textContent = \"New Task\";\n        newTaskButton.addEventListener('click', async () => {\n            const task = new Task(\"New Task\", null, null, false);\n            const success:boolean = await createRemoteTask(calendar, task);\n            if (success) {\n                calendar_div.insertBefore(buildDisplayableTask(task, true), calendar_div.lastChild);\n            }\n        });\n        heading.appendChild(newTaskButton);\n        calendar_div.appendChild(heading);\n        //Show done tasks separately\n        let done_div:HTMLElement = document.createElement('div');\n        let done_div_content:HTMLElement = document.createElement('div');\n        done_div_content.className = 'collapsible';\n        let done_div_button:HTMLElement = document.createElement('button');\n        done_div_button.className = 'button';\n        done_div_button.textContent = \"Show Done\";\n        done_div_button.addEventListener('click', async () => {\n            if (done_div_content.style.maxHeight){\n                done_div_content.style.maxHeight = null;\n            } else {\n                done_div_content.style.maxHeight = done_div_content.scrollHeight + \"px\";\n            }\n        })\n        done_div.appendChild(done_div_button);\n        done_div.appendChild(done_div_content);\n        const objects:any = await fetchTasks(calendar);\n        for (const object of objects) {\n            const task = new Task(object.data, object.etag, object.url);\n            if (task.completed) {\n                done_div_content.appendChild(buildDisplayableTask(task));\n            } else {\n                calendar_div.appendChild(buildDisplayableTask(task));\n            }\n        }\n        calendar_div.appendChild(done_div);\n        task_list.appendChild(calendar_div);\n    }\n}\n\n//----------------------------- Local Tasks -----------------------------------\nconst local_task_list:HTMLElement = document.getElementById('local_task_list');\nlet localTasks:Task[] = null;\n\nasync function saveLocalTasks():Promise<void> {\n    localStorage.setItem(\"local_tasks\", JSON.stringify(localTasks));\n}\nfunction recoverSavedTasks():void {\n    const savedTasks:any = JSON.parse(localStorage.getItem(\"local_tasks\"));\n    if (savedTasks === null || savedTasks.length === 0) {\n        localTasks = [];\n        localTasks.push(new Task(\"This is your first task!\"));\n    } else {\n        // Reconstruct Task objects from plain objects\n        localTasks = savedTasks.map(taskData => {\n            const task = new Task(taskData.summary);\n            Object.assign(task, taskData);\n            return task;\n        });\n    }\n}\nfunction displaySavedTasks():void {\n    local_task_list.innerHTML = '';\n    for (const task of localTasks) {\n        local_task_list.appendChild(buildDisplayableTask(task));\n    }\n}\n\ndocument.getElementById('create_local_button').addEventListener('click', ():void => {\n    const task = new Task(\"New Task\");\n    localTasks.push(task);\n    saveLocalTasks();\n    local_task_list.appendChild(buildDisplayableTask(task, true));\n})\n\nrecoverSavedTasks();\ndisplaySavedTasks();\n\n//----------------------------- Build Task -----------------------------------\n\nfunction buildDisplayableTask(task: Task, fresh:boolean = false):HTMLElement {\n    let task_div:HTMLElement = document.createElement('div');\n    task_div.className = \"task\";\n    let checkbox:HTMLInputElement = document.createElement('input');\n    checkbox.type = \"checkbox\";\n    checkbox.className = \"task_checkbox\";\n    checkbox.checked = task.completed;\n    checkbox.addEventListener('change', ():void => {\n        if (checkbox.checked) {\n            task.setDone();\n            if (sparcle_mode) {\n                unicornAnimation();\n            }\n        } else {\n            task.setNotDone();\n        }\n        updateRemoteTask(task);\n        saveLocalTasks();\n    })\n    task_div.appendChild(checkbox);\n    let textSpan:HTMLSpanElement = document.createElement('span');\n    textSpan.textContent = \" \" + task.getSummary();\n    textSpan.style.width = \"100%\";\n    //Editing\n    let task_edit:HTMLElement = document.createElement('div');\n    task_edit.className = \"popup\";\n    let name_edit_label:HTMLLabelElement = document.createElement('label');\n    let name_edit:HTMLInputElement = document.createElement('input');\n    let due_edit_label:HTMLLabelElement = document.createElement('label');\n    let due_edit:HTMLInputElement = document.createElement('input');\n    let delete_edit:HTMLButtonElement = document.createElement('button');\n\n    const name_edit_label_text:HTMLSpanElement = document.createElement('span');\n    name_edit_label_text.textContent = \"Edit Name: \";\n    name_edit_label.appendChild(name_edit_label_text);\n    name_edit_label.appendChild(name_edit);\n    name_edit.value = task.getSummary();\n    name_edit.addEventListener('change', () => {\n        task.updateTaskName(name_edit.value);\n        textSpan.textContent = \" \" + task.getSummary();\n    })\n\n    delete_edit.className = \"button\";\n    delete_edit.textContent = \"Delete Task\";\n    delete_edit.style.color = \"#c21919\";\n    delete_edit.addEventListener('click', () => {\n        task_edit.style.display = 'none';\n        document.removeEventListener('keydown', keyHandler);\n        document.removeEventListener('click', clickHandler);\n        deleteTask(task, task_div);\n    })\n\n    const due_edit_label_text:HTMLSpanElement = document.createElement('span');\n    due_edit_label_text.textContent = \"Edit Due Date: \";\n    due_edit_label.appendChild(due_edit_label_text);\n    due_edit_label.appendChild(due_edit);\n    due_edit.type = \"datetime-local\";\n    due_edit.value = task.getDue();\n    due_edit.addEventListener('change', () => {\n        task.setDue(due_edit.value);\n    })\n\n    task_edit.appendChild(name_edit_label);\n    task_edit.appendChild(document.createElement('br'));\n    task_edit.appendChild(due_edit_label);\n    task_edit.appendChild(document.createElement('br'));\n    task_edit.appendChild(document.createElement('br'));\n    task_edit.appendChild(delete_edit);\n    // close/open edit window\n    const keyHandler = (e) => {\n        if (e.key === 'Escape') {\n            task_edit.style.display = 'none';\n            document.removeEventListener('keydown', keyHandler);\n            document.removeEventListener('click', clickHandler);\n            updateRemoteTask(task);\n            saveLocalTasks();\n            displaySavedTasks();\n        }\n    };\n    const clickHandler = (e) => {\n        if (!task_edit.contains(e.target) && e.target !== textSpan) {\n            task_edit.style.display = 'none';\n            document.removeEventListener('keydown', keyHandler);\n            document.removeEventListener('click', clickHandler);\n            updateRemoteTask(task);\n            saveLocalTasks();\n            displaySavedTasks();\n        }\n    };\n    textSpan.addEventListener('click', () => {\n        task_edit.style.display = \"block\";\n        setTimeout(() => {  //slight delay to avoid immediate triggering\n            document.addEventListener('keydown', keyHandler);\n            document.addEventListener('click', clickHandler);\n        }, 10);\n    });\n    if (fresh) {\n        task_edit.style.display = \"block\";\n        setTimeout(() => {\n            document.addEventListener('keydown', keyHandler);\n            document.addEventListener('click', clickHandler);\n        }, 10);\n    }\n    task_div.appendChild(textSpan);\n    task_div.appendChild(task_edit);\n    return task_div;\n}\n\n//----------------------------- Ui -----------------------------------\n\nfunction unicornAnimation() {\n    const unicorn = document.getElementById('unicorn');\n    unicorn.style.display = 'block';\n    setTimeout(() => {\n        unicorn.style.display = 'none';\n    }, 3000);\n}\n\n//----------------------------- Buttons -----------------------------------\nconst settingsButton:HTMLButtonElement = document.getElementById('settings_button') as HTMLButtonElement;\nconst popup:HTMLElement = document.getElementById('settings');\n\nsettingsButton.addEventListener('click', () => {\n    popup.style.display = popup.style.display === '' || popup.style.display === 'none' ? 'block' : 'none';\n});\ndocument.addEventListener('click', (event) => {\n    // @ts-ignore\n    if (popup.style.display === 'block' && !popup.contains(event.target) && !settingsButton.contains(event.target)) {\n        popup.style.display = 'none';\n    }\n});\ndocument.addEventListener('keydown', (event) => {\n    if (event.key === 'Escape') {\n        popup.style.display = 'none';\n    }\n});\n\ndocument.getElementById('login_button').addEventListener('click', () => {\n    loginToServer();\n});\ndocument.getElementById('login_remember_button').addEventListener('click', () => {\n    loginToServer(true);\n});\n\ndocument.getElementById('login_forget_button').addEventListener('click', () => {\n    task_list.innerHTML = '';\n    localStorage.removeItem('url');\n    localStorage.removeItem('username');\n    localStorage.removeItem('password');\n    document.getElementById('big_login_status').style.display = \"block\";\n});\nlet sparcle_mode:boolean = false;\ndocument.getElementById('sparcle_button').addEventListener('click', () => {\n    if (sparcle_mode) {\n        document.body.className = 'normal';\n        sparcle_mode = false;\n    } else {\n       document.body.className = 'sparcle';\n         sparcle_mode = true;\n    }\n});\n\n\n\n\n\n\n\n"],"names":["Task","constructor","dataOrSummary","etag","url","localTask","this","data","summary","getInfoFromICal","uuid","uid","created","lastModified","dtstamp","completed","due","setDone","setNotDone","getUrl","Math","random","toString","substring","setUrl","getData","crypto","randomUUID","formatDateForICS","updateTaskName","name","getSummary","getDue","setDue","value","date","Date","toISOString","replace","split","ical","matches","match","forEach","RegExp","exec","trim","statusMatch","status","dueMatch","proxyURL","sessionID","async","fetchTasks","calender","response","fetch","encodeURIComponent","JSON","stringify","method","ok","json","console","error","statusText","updateRemoteTask","task","headers","body","filename","text","createRemoteTask","calendar","tasks","object","login_status","document","getElementById","loginToServer","remember","textContent","username","password","serverUrl","login","style","display","calendars","getCalenders","calendar_div","createElement","heading","displayName","newTaskButton","className","marginLeft","addEventListener","insertBefore","buildDisplayableTask","lastChild","appendChild","done_div","done_div_content","done_div_button","maxHeight","scrollHeight","objects","task_list","fetchAndDisplay","localStorage","setItem","getItem","autoLogin","local_task_list","localTasks","saveLocalTasks","displaySavedTasks","innerHTML","fresh","task_div","checkbox","type","checked","sparcle_mode","unicorn","setTimeout","unicornAnimation","textSpan","width","task_edit","name_edit_label","name_edit","due_edit_label","due_edit","delete_edit","name_edit_label_text","color","removeEventListener","keyHandler","clickHandler","parentElement","removeChild","err","filter","t","deleteTask","due_edit_label_text","e","key","contains","target","push","savedTasks","parse","length","map","taskData","Object","assign","recoverSavedTasks","settingsButton","popup","event","removeItem"],"mappings":"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"}